/// Сервис для категоризации товаров из чека
class ReceiptCategorizationService {
  // Локальный словарь ключевых слов для категоризации
  static final Map<String, String> _keywordMap = {
    // Продукты
    'хлеб': 'Продукты',
    'молоко': 'Продукты',
    'яйца': 'Продукты',
    'яйцо': 'Продукты',
    'сыр': 'Продукты',
    'масло': 'Продукты',
    'мясо': 'Продукты',
    'курица': 'Продукты',
    'рыба': 'Продукты',
    'овощи': 'Продукты',
    'фрукты': 'Продукты',
    'картофель': 'Продукты',
    'помидор': 'Продукты',
    'огурец': 'Продукты',
    'яблоко': 'Продукты',
    'банан': 'Продукты',
    'сахар': 'Продукты',
    'соль': 'Продукты',
    'мука': 'Продукты',
    'макарон': 'Продукты',
    'рис': 'Продукты',
    'крупа': 'Продукты',
    'колбаса': 'Продукты',
    'сосиск': 'Продукты',
    'йогурт': 'Продукты',
    'творог': 'Продукты',
    'кефир': 'Продукты',
    'сметана': 'Продукты',
    'вода': 'Продукты',
    'сок': 'Продукты',
    'чай': 'Продукты',
    'кофе': 'Продукты',
    'конфет': 'Продукты',
    'шоколад': 'Продукты',
    'печенье': 'Продукты',

    // Транспорт
    'бензин': 'Транспорт',
    'аи-92': 'Транспорт',
    'аи-95': 'Транспорт',
    'аи-98': 'Транспорт',
    'дизель': 'Транспорт',
    'топливо': 'Транспорт',
    'азс': 'Транспорт',
    'заправка': 'Транспорт',

    // Такси
    'такси': 'Такси',
    'uber': 'Такси',
    'яндекс': 'Такси',
    'bolt': 'Такси',
    'поездка': 'Такси',

    // Здоровье
    'аптека': 'Здоровье',
    'лекарство': 'Здоровье',
    'таблетк': 'Здоровье',
    'витамин': 'Здоровье',
    'медикамент': 'Здоровье',
    'бинт': 'Здоровье',
    'пластырь': 'Здоровье',

    // Кафе и рестораны
    'кафе': 'Кафе и рестораны',
    'ресторан': 'Кафе и рестораны',
    'кофейня': 'Кафе и рестораны',
    'макдональдс': 'Кафе и рестораны',
    'kfc': 'Кафе и рестораны',
    'бургер': 'Кафе и рестораны',
    'пицца': 'Кафе и рестораны',
    'суши': 'Кафе и рестораны',

    // Развлечения
    'кино': 'Развлечения',
    'билет': 'Развлечения',
    'театр': 'Развлечения',
    'музей': 'Развлечения',
    'парк': 'Развлечения',

    // Одежда
    'футболка': 'Одежда',
    'рубашка': 'Одежда',
    'брюки': 'Одежда',
    'джинсы': 'Одежда',
    'куртка': 'Одежда',
    'пальто': 'Одежда',
    'обувь': 'Одежда',
    'кроссовки': 'Одежда',
    'туфли': 'Одежда',
    'ботинки': 'Одежда',

    // Косметика
    'шампунь': 'Косметика',
    'мыло': 'Косметика',
    'гель': 'Косметика',
    'крем': 'Косметика',
    'помада': 'Косметика',
    'тушь': 'Косметика',
    'духи': 'Косметика',

    // Дом и быт
    'моющее': 'Дом и быт',
    'порошок': 'Дом и быт',
    'средство': 'Дом и быт',
    'губка': 'Дом и быт',
    'тряпка': 'Дом и быт',
    'ведро': 'Дом и быт',
    'лампа': 'Дом и быт',
    'батарейка': 'Дом и быт',
  };

  /// Категоризировать товар по названию
  Future<Map<String, dynamic>> categorizeItem(String itemName) async {
    final normalized = itemName.toLowerCase();

    // Поиск по ключевым словам
    for (var entry in _keywordMap.entries) {
      if (normalized.contains(entry.key)) {
        return {
          'category': entry.value,
          'confidence': 0.75, // Средняя уверенность для словарного метода
        };
      }
    }

    // Fallback: категория по умолчанию
    return {
      'category': 'Прочее',
      'confidence': 0.3, // Низкая уверенность
    };
  }

  /// Пакетная категоризация товаров
  Future<List<Map<String, dynamic>>> categorizeItems(List<String> itemNames) async {
    return Future.wait(itemNames.map((name) => categorizeItem(name)));
  }
}
